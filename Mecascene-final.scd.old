(
Server.killAll;
~supercoll = OSSIA_Device("SC");
~supercoll.exposeOSC("127.0.0.1",9997,9980,nil);
Server.supernova; s = Server.local; o = s.options;
o.blockSize = 48;
o.memSize = 8192 * 12; o.numAudioBusChannels = 2048;
o.numWireBufs = 512; o.numInputBusChannels = 44;
o.numOutputBusChannels = 44;
s.waitForBoot {
	~decoder = Mecascene5; ~order = 5; ~out = 4; ~sub = [0, 1, 2, 3];
	~setup = [
		[ 45.0, 72.822694280027, 9.5771864344389 ],
		[ -45.0, 72.822694280027, 9.5771864344389 ],
		[ -225.0, 72.822694280027, 9.5771864344389 ],
		[ -135.0, 72.822694280027, 9.5771864344389 ],
		[ 45.0, 32.86849518, 9.7657564991146 ],
		[ -225.0, 32.86849518, 9.7657564991146 ],
		[ -45.0, 32.86849518, 9.7657564991146 ],
		[ -135.0, 32.86849518, 9.7657564991146 ],
		[ -143.13010235416, 15.422161318739, 7.5208044782457 ],
		[ -153.43494882292, 17.140974746241, 6.7860150309294 ],
		[ -165.96375653207, 18.496731938763, 6.3041652897112 ],
		[ -180.0, 19.025606037569, 6.1351446600712 ],
		[ -194.03624346793, 18.496731938763, 6.3041652897112 ],
		[ -206.56505117708, 17.140974746241, 6.7860150309294 ],
		[ -216.86989764584, 15.422161318739, 7.5208044782457 ],
		[ 53.130102354156, 16.880330165524, 7.5764437568031 ],
		[ 63.434948822922, 18.740301100448, 6.847627326308 ],
		[ 75.963756532074, 20.202862587463, 6.3704395452747 ],
		[ 90.0, 20.772254682046, 6.2032249677083 ],
		[ -255.96375653207, 20.202862587463, 6.3704395452747 ],
		[ -243.43494882292, 18.740301100448, 6.847627326308 ],
		[ -233.13010235416, 16.880330165524, 7.5764437568031 ],
		[ -225.0, 15.01409717663, 8.4923494982249 ],
		[ -53.130102354156, 16.880330165524, 7.5764437568031 ],
		[ -63.434948822922, 18.740301100448, 6.847627326308 ],
		[ -75.963756532074, 20.202862587463, 6.3704395452747 ],
		[ -90.0, 20.772254682046, 6.2032249677083 ],
		[ -104.03624346793, 20.202862587463, 6.3704395452747 ],
		[ -116.56505117708, 18.740301100448, 6.847627326308 ],
		[ -126.86989764584, 16.880330165524, 7.5764437568031 ],
		[ -135.0, 15.01409717663, 8.4923494982249 ],
		[ 45.0, 15.01409717663, 8.4923494982249 ], [ -45.0, 15.01409717663, 8.4923494982249 ],
		[ 36.869897645844, 3.5517333548204, 7.263952092353 ], [ 26.565051177078, 3.9696887205086, 6.5001923048476 ], [ 14.036243467926, 4.3045179305752, 5.9954149147494 ], [ 0.0, 4.4364744856574, 5.8174307043574 ], [ -14.036243467926, 4.3045179305752, 5.9954149147494 ], [ -26.565051177078, 3.9696887205086, 6.5001923048476 ], [ -36.869897645844, 3.5517333548204, 7.263952092353 ]];
	// MIDIIn.connect();  // must connect to MIDI for MMC synch
                s.sync;
                ~moscaInstance = Mosca( server:s, nsources: 16, dur: 9,
                               speaker_array:~setup,
                               maxorder:~order,
                               outbus:~out,
                               suboutbus:~sub,
                               decoder: ~decoder,
                               //rirBank:"/home/scrime/Documents/proj/rirBank",
                               parentOssiaNode:~supercoll;
                ).gui();
};


o.numOutputBusChannels.do({|i|
	Pipe("jack_disconnect ossia' 'score:out_"++(i) + "system:playback_"++(i+1),"w");
});
)
